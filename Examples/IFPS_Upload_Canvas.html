<script src="https://aloycwl.github.io/js/cdn/jquery.min.js"></script>
<script src="https://aloycwl.github.io/js/cdn/ipfs-api.min.js"></script>

<canvas id="myCanvas" width="100" height="100"></canvas>
<script>
  var c = document.getElementById('myCanvas'),
    cd = c.getContext('2d');
  draw('https://aloycwl.github.io/js/Examples/IFPS_Upload_Canvas_0.png');
  draw('https://aloycwl.github.io/js/Examples/IFPS_Upload_Canvas_1.png');

  async function draw(s) {
    var img = new Image();
    img.setAttribute('crossorigin', 'anonymous');
    img.src = s;
    cd.drawImage(img, 0, 0);
  }

  async function load() {
    var ipfs = IpfsApi({
        host: 'ipfs.infura.io',
        port: 5001,
        protocol: 'https',
      }),
      reader = new FileReader(),
      b64 = atob(c.toDataURL('image/png').split(',')[1]),
      n = b64.length,
      u8 = new Uint8Array(n),
      pro = await new Promise((d) => {
        reader.onloadend = () => {
          ipfs.add(ipfs.Buffer.from(reader.result)).then((files) => {
            d(files);
          });
        };
        while (n--) u8[n] = b64.charCodeAt(n);
        reader.readAsArrayBuffer(new File([u8], '0.png'));
      });
    console.log(pro[0].hash);
  }
  load();
</script>
